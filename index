// index.js

const express = require('express');
const axios = require('axios');
const app = express();

app.use(express.json());

const Z_API_TOKEN = '845113E139DAD69E70DA7D16'; // Substitua pela sua chave Z-API
const Z_API_URL = 'https://api.z-api.io/instances/3E0E55D43765B06F8F4396870211A73F/token/845113E139DAD69E70DA7D16/send-text';

async function enviarMensagem(telefone, mensagem) {
  try {
    await axios.post(Z_API_URL, {
      phone: telefone,
      message: mensagem
    });
  } catch (error) {
    console.error('Erro ao enviar mensagem:', error.response?.data || error.message);
  }
}

app.post('/webhook', async (req, res) => {
  const mensagem = req.body;

  const telefone = mensagem.phone;
  const msg = mensagem.message.toLowerCase();

  if (msg.includes('menu') || msg === 'oi' || msg === 'olÃ¡') {
    await enviarMensagem(telefone, `ðŸŽ‰ *Banda ForrÃ³ das Antigas* ðŸŽ¶\n\nEm qual tipo de evento vocÃª quer contratar a banda?\n\n1ï¸âƒ£ - Casamento ðŸ’\n2ï¸âƒ£ - AniversÃ¡rio ðŸŽ‚\n3ï¸âƒ£ - Festa Junina ðŸŽŠ\n4ï¸âƒ£ - Evento Corporativo ðŸ¢\n5ï¸âƒ£ - Ver vÃ­deos da banda ðŸŽ¥\n6ï¸âƒ£ - Falar com um atendente ðŸ‘¤`);
  } else if (msg === '1') {
    await enviarMensagem(telefone, 'ðŸ’ Casamentos sÃ£o especiais! Tocamos forrÃ³ romÃ¢ntico e animado. Envie a data e local para receber um orÃ§amento exclusivo.');
  } else if (msg === '2') {
    await enviarMensagem(telefone, 'ðŸŽ‚ AniversÃ¡rio com forrÃ³ Ã© alegria garantida! Nos diga o dia, cidade e nÃºmero de convidados para fazermos um orÃ§amento.');
  } else if (msg === '3') {
    await enviarMensagem(telefone, 'ðŸŽŠ Adoramos festa junina! Quadrilha, forrÃ³ pÃ© de serra e clÃ¡ssicos das antigas. Mande os detalhes do evento para orÃ§amento!');
  } else if (msg === '4') {
    await enviarMensagem(telefone, 'ðŸ¢ Para eventos corporativos, oferecemos um show animado e profissional para confraternizaÃ§Ãµes, SIPAT, premiaÃ§Ãµes e mais. Envie local, data e tipo do evento para orÃ§amento.');
  } else if (msg === '5') {
    await enviarMensagem(telefone, 'ðŸŽ¥ Veja nossos vÃ­deos no YouTube: https://youtube.com/sua-banda');
  } else if (msg === '6') {
    await enviarMensagem(telefone, 'ðŸ‘¤ Um atendente vai falar com vocÃª em instantes pelo WhatsApp!');
  } else {
    await enviarMensagem(telefone, 'NÃ£o entendi ðŸ˜•. Digite *menu* para ver as opÃ§Ãµes.');
  }

  res.sendStatus(200);
});

const PORT = process.env.PORT || 3000;
app.listen(PORT, () => console.log(`Servidor rodando na porta ${PORT}`));
